
stages:
  - docker-build
  - build
  - verification

build:images:
  stage: docker-build
  only: 
    - master
  script:
    - make -f docker.mk base-build
    - make -f docker.mk dev-build
  tags:
    - docker-shell

build:
  stage: build
  image: "otaviog/tensorviz-base:latest"
  script:
    - python setup.py install
  tags:
    - container

##
# Verification stage
linter:
  before_script:
    - python setup.py develop
    - pip install -r requirements-dev.txt
  needs: ["build"]
  image: "otaviog/tensorviz-base:latest"
  stage: verification
  script:
    - make -f tasks.mk pylint
  tags:
    - container

unit-test:
  before_script:
    - python setup.py develop
  needs: ["build"]
  image: "otaviog/tensorviz-base:latest"
  stage: verification
  script:
    - make -f unit-tests.mk all
  tags:
    - container-x11
